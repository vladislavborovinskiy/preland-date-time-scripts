# Разработчик | Дата/Время

❗ Обязательно ознакомьтесь с [Инструкцией применения скрипта Дата/Время для верстальщика](https://www.notion.so/9c623a9a35044dfea62a0b5daf0d22ea?pvs=21).

## Общая информация

- Модуль Дата/Время предназначен для динамического отображения временных меток на лендингах;
- Скрипт решает задачу минимизации ошибок в значениях Дата/Время, обеспечивая корректное отображение для разных локализаций;
- Модуль состоит из трех основных файлов JavaScript, расположенных в директории `/time-scripts/`;
- Поддерживается многоязычность и различные форматы отображения даты и времени

## Архитектура модуля

### Структура файлов

- `main.js` — основная логика приложения, обработка HTML-элементов с атрибутами;
- `translations.js` — массив данных локализации для различных языков и стран;
- `utils.js` — утилиты для форматирования и расчета дат и времени

### Принцип работы

1. При загрузке страницы `main.js` ищет все элементы с атрибутом `data-time-function`;
2. В зависимости от значения атрибута, вызывается соответствующая функция;
3. Для форматирования используются значения атрибутов `data-time-value` и `data-time-format`;
4. Для элементов с функциями комментариев применяется дополнительная логика с использованием данных из `translations.js`

## Технические детали модуля

### Основные переменные и функции в `utils.js`

- `optionsDownload`, `optionsTime`, `optionsWeeks` — опции для форматирования дат;
- `contentDate()` — функция для расчета даты, времени и дня недели;
- `formatDate()` — функция для форматирования даты с учетом локали;
- `commentsDate()` — функция для расчета даты комментариев

```jsx
// Ключевые аспекты функции contentDate()
export const contentDate = (addHours, t, format) => {
  let quantityHours = -24;
  let OldDate = new Date();

  // Логика работы со временем для получения "реалистичных" временных меток
  if (hours < 9) {
    quantityHours = -24 + 8;
  }
  if (hours > 19) {
    quantityHours = -24 - 6;
  }

  // Добавление случайной составляющей для более естественного отображения
  OldDate.setHours(hours + addHours + quantityHours);
  OldDate.setMinutes(minutes + random);

  // Форматирование с учетом локали
  let newdate = OldDate.toLocaleDateString(format, options);

  return newdate;
};
```

### Логика в `main.js`

- Экспортируемые функции для использования в HTML-элементах:
  - `datePublicArticle()` — дата публикации;
  - `dayOfWeek()` — день недели;
  - `timePublicArticle()` — время публикации;
  - и другие (подробнее в [инструкции Дата/время](https://www.notion.so/9c623a9a35044dfea62a0b5daf0d22ea?pvs=21));
- Счетчики для комментариев:
  - `countryMinutesCommentsForTime` — для времени комментариев;
  - `countryMinutesCommentsForDate` — для даты комментариев;
  - `callCountComments` — счетчик вызовов функции комментариев;
- Обработка элементов:
  - Получение элементов с атрибутом `data-time-function`;
  - Извлечение значений атрибутов `data-time-value` и `data-time-format`;
  - Вызов соответствующей функции из объекта `functions`.

### Структура данных в `translations.js`

- Массив объектов `translations` с локализацией для разных языков и стран;
- Каждый объект содержит:
  - `id` — идентификатор языка (используется для поиска);
  - `language` — название языка;
  - `country` — название страны;
  - `minutesText`, `oneHourText`, `twoHoursText` — шаблоны для отображения времени.

## Алгоритмы и специфические особенности

### Алгоритм расчета времени комментариев

1. В `counterComments()` определяется, сколько времени прошло с момента публикации комментария:
   - Первые 4 комментария используют фиксированные значения (0.2, 0.4, 0.6, 0.8);
   - Последующие комментарии используют часы (от 1 до 7);
2. Логика в `updatedTextComment()`:
   - Для значений меньше 1 используется "minutesText" (минуты);
   - Для значения 1 используется "oneHourText" (1 час);
   - Для значений больше 1 используется "twoHoursText" (N часов).

### Алгоритм расчета времени ответов на комментарии

1. В `updatedTextCommentAnswer()` время ответа всегда меньше времени комментария:
   - Используется случайное смещение от 3 до 10 минут;
   - Проверяется, что время ответа не дублирует существующие значения.

### Особенности реализации

- Для естественности добавляется случайный компонент к времени;
- Избегается генерация времени, которое выглядит неестественно (например, ответ позже комментария).

## Процесс изменения и обновления модуля

### Добавление новой локализации

1. Добавьте новый объект в массив `translations` в файле `translations.js`:

```jsx
{
  id: "новый_код_языка",
  language: "Название языка",
  country: "Название страны",
  minutesText: "NN минут назад",
  oneHourText: "1 час назад",
  twoHoursText: "N часов назад",
},
```

1. Убедитесь, что в тексте шаблонов присутствует число, которое будет заменено.

### Внесение изменений в алгоритмы

- При модификации алгоритмов расчета дат учитывайте обратную совместимость;
- Тестируйте изменения на различных локализациях;
- Помните, что изменения в `utils.js` могут повлиять на отображение всех временных меток.

## Обновление репозитория

1. Добавьте изменённые файлы в индекс:

   ```bash
   git add .
   ```

2. Создайте коммит с описанием внесённых изменений:

   ```bash
   git commit -m "Ваше описание изменений"
   ```

3. Отправьте изменения в удалённый репозиторий:

   ```bash
   git push
   ```

4. Обновите [документацию для верстальщиков](https://www.notion.so/9c623a9a35044dfea62a0b5daf0d22ea?pvs=21) при необходимости.
